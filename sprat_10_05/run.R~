library(Rgadget)
library(ggplot2)
library(grid)
library(gridExtra)

## rm(list=ls())

source("~/../valerio/Share/Gadget/Rscripts/ggdata_coverage.R")
source("~/../valerio/Share/Gadget/Rscripts/add_captionModel.R")

setwd(gd$dir)

tmp <- gadget.iterative(rew.sI=TRUE,
                        grouping=list(
                          sind=c('si0.spr.rct3','si1.spr.bias','si2.spr.bias','si3.spr.bias','si4.spr.bias','si5.spr.bias','si6.spr.bias','si7.spr.bias','si8.spr.bias')),                       
                        params.file='params.in',
                        wgts='WGTS')

fit <- gadget.fit(main="WGTS/main.final",
                  f.age.range=data.frame(stock=c("sprimm","sprmat"),age.min=1,age.max=3))

## load("WGTS/WGTS.Rdata")
## fit <- out

# ------------------------------------------
# standard plots
dirFigs <- "out"
if(sum(match(list.files(),dirFigs), na.rm=T)==1){
    print(paste("folder",dirFigs,"exists"))
} else {system(paste("mkdir",dirFigs))}

cairo_ps(paste(dirFigs,"sidat_dir.ps", sep="/"))
  plot(fit, data = "sidat", type = "direct") +
    ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"sidat_xy.ps", sep="/"))
  plot(fit, data = "sidat", type = "x-y") +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"summary.ps", sep="/"))
  plot(fit, data='summary') +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"summary_wgt.ps", sep="/"))
  plot(fit, data='summary',type = 'weighted') +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"summary_pie.ps", sep="/"))
  plot(fit, data='summary',type='pie') +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"catch.ps", sep="/"))
  plot(fit, data="res.by.year", type="catch") + facet_wrap(~stock) +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"F.ps", sep="/"))
  plot(fit, data="res.by.year", type="F") + facet_wrap(~stock) +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"total.ps", sep="/"))
  plot(fit, data="res.by.year", type="total") + facet_wrap(~stock) +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"rec.ps", sep="/"))
  plot(fit, data="res.by.year", type="rec") + facet_wrap(~stock) +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"stock_demo.ps", sep="/"))
  plot(fit, data='stock.std')# + facet_wrap(~stock) +
  ggRunName() + ggRunNameSize(6)
dev.off()
cairo_ps(paste(dirFigs,"suitability.ps", sep="/"))
  plot(fit, data='suitability') +
  ggRunName() + ggRunNameSize(6)
dev.off()
tmp <- plot(fit,data = 'catchdist.fleets')
  names(tmp)
  cairo_ps(paste(dirFigs,"ldist_spr_bias.ps", sep="/"))
    tmp$ldist.spr.bias +
  ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"alk_com.ps", sep="/"))
    tmp$alk.spr.bias +
  ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"adist_spr_com1.ps", sep="/"))
    tmp$adist.spr.com1 +
  ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"adist_spr_com2.ps", sep="/"))
    tmp$adist.spr.com2 +
    ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"adist_seal.ps", sep="/"))
    tmp$adist.ven.seal +
  ggRunName() + ggRunNameSize(6)
  dev.off()
bubbles <- plot(fit,data = 'catchdist.fleets',type='bubble')
  names(bubbles)
  cairo_ps(paste(dirFigs,"bubble_ldist.ps", sep="/"))
    bubbles$ldist +
  ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"bubble_adist.ps", sep="/"))
    bubbles$aldist
  dev.off()
grplot <- plot(fit,data = 'catchdist.fleets',type='growth')
  names(grplot)
  cairo_ps(paste(dirFigs,"growth_com.ps", sep="/"))
    grplot$adist.spr.com1 +
  ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"growth_aco.ps", sep="/"))
  grplot$alk.spr.bias +
    ggRunName() + ggRunNameSize(6)
  dev.off()
  tmp <- plot(fit,data = 'stockdist')
  names(tmp)
  cairo_ps(paste(dirFigs,"mat_com.ps", sep="/"))
    tmp$mat.ven.com + xlim(9,18) +
  ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"mat_aco.ps", sep="/"))
    tmp$mat.ven.aco + xlim(9,18) +
  ggRunName() + ggRunNameSize(6)
  dev.off()
  cairo_ps(paste(dirFigs,"data_coverage.ps", sep="/"))
    ggDataCoverage(fit) +
  ggRunName() + ggRunNameSize(6)
  dev.off()

# merge into a PDF
system(paste("convert -density 120x120 -quality 100 $(ls ",dirFigs,"/*.ps) ",dirFigs,"/figs_all.pdf",sep=""))
